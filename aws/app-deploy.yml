apiVersion: apps/v1
kind: Deployment
metadata:
  name: immigration-app-aws
  labels:
    app: immigration-app
spec:
  replicas: 1  # Warm Standbyë‹ˆê¹Œ 1ê°œë§Œ ìœ ì§€ (ë¹„ìš© ì ˆê°)
  selector:
    matchLabels:
      app: immigration-app
  template:
    metadata:
      labels:
        app: immigration-app
    spec:
      containers:
        - name: immigration-app
          # ğŸ‘‡ í˜•ë‹˜ì´ ì°¾ì€ ê·¸ ECR ì£¼ì†Œì…ë‹ˆë‹¤. (:latest íƒœê·¸ ì‚¬ìš©)
          image: 708467047243.dkr.ecr.ap-northeast-2.amazonaws.com/curry-app:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 8080
          env:
            # âš ï¸ ì¤‘ìš”: ì•„ì§ AWSì— DBê°€ ì—†ìœ¼ë¯€ë¡œ, ë‚˜ì¤‘ì— Slave DB ë§Œë“¤ë©´ ê·¸ IPë¡œ ë°”ê¿”ì•¼ í•¨
            # ì§€ê¸ˆì€ ì¼ë‹¨ ë¹„ì›Œë‘ê±°ë‚˜ ë”ë¯¸ë¡œ ë‘¡ë‹ˆë‹¤.
            - name: DB_HOST
              value: "mariadb-aws-service" 
            - name: DB_PORT
              value: "3306"
            - name: DB_NAME
              value: "immigration"
            - name: DB_USER
              value: "root"
            - name: DB_PW
              value: "test1234" # (ë³´ì•ˆìƒ ë‚˜ì¤‘ì— ì‹œí¬ë¦¿ìœ¼ë¡œ ë¹¼ëŠ” ê²Œ ì¢‹ìŒ)

---
apiVersion: v1
kind: Service
metadata:
  name: immigration-app-service-aws
spec:
  # AWSì—ì„œëŠ” LoadBalancer ì“°ë©´ ìë™ìœ¼ë¡œ ì™¸ë¶€ ì£¼ì†Œ(CLB/NLB)ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
  type: LoadBalancer
  selector:
    app: immigration-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
